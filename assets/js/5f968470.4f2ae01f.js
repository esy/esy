"use strict";(self.webpackChunksite_v_3=self.webpackChunksite_v_3||[]).push([[7491],{8428:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var i=t(5893),s=t(1151);const c={id:"docker-and-static-linking",title:"Docker and static linking"},a=void 0,o={id:"docker-and-static-linking",title:"Docker and static linking",description:"Docker image",source:"@site/../docs/docker-and-static-linking.md",sourceDirName:".",slug:"/docker-and-static-linking",permalink:"/docs/docker-and-static-linking",draft:!1,unlisted:!1,editUrl:"https://github.com/esy/esy/tree/master/docs/../docs/docker-and-static-linking.md",tags:[],version:"current",lastUpdatedBy:"prometheansacrifice",lastUpdatedAt:1725276666,formattedLastUpdatedAt:"Sep 2, 2024",frontMatter:{id:"docker-and-static-linking",title:"Docker and static linking"}},r={},l=[{value:"Docker image",id:"docker-image",level:2},{value:"Static linking",id:"static-linking",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"docker-image",children:"Docker image"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"esy"})," is currently available as an alpine image only. See ",(0,i.jsx)(n.a,{href:"https://hub.docker.com/r/esydev/esy",children:"Docker\nHub"})," for the complete list."]}),"\n",(0,i.jsx)(n.h2,{id:"static-linking",children:"Static linking"}),"\n",(0,i.jsx)(n.p,{children:"The alpine image can be used to build statically link Reason/OCaml\nbinaries. Here's an example Docker image."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Dockerfile",children:'FROM esydev/esy:nightly-alpine-latest\n\nCOPY package.json package.json\nCOPY esy.lock esy.lock\nRUN esy i\nRUN esy build-dependencies\nCOPY hello.ml hello.ml\nRUN esy\n\nENTRYPOINT ["/entrypoint.sh"]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"package.json"})," / ",(0,i.jsx)(n.code,{children:"esy.json"})," must use a compiler version that uses\n",(0,i.jsx)(n.code,{children:"musl-libc"}),". ",(0,i.jsx)(n.code,{children:"4.10.1002-musl.static.flambda"})," is one such versions."]}),"\n",(0,i.jsxs)(n.p,{children:["The statically linked binaries can be copied out of the container with\n",(0,i.jsx)(n.code,{children:"docker cp"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Here's a same github action job doing so."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'static-build:\n  runs-on: ubuntu-latest\n  steps:\n    - name: Set up Docker Buildx\n      uses: docker/setup-buildx-action@v3\n    - name: Build and push\n      uses: docker/build-push-action@v5\n      with:\n        file: ./Dockerfile\n        push: false\n        tags: user/app:latest\n    - run: |\n        docker container run --pull=never -itd --network=host --name "<CONTAINER_NAME>" "<IMAGE:TAG>"\n        docker cp "<CONTAINER_NAME>:/path/to/built/binary" "<HOST_PATH>/binary"\n      name: "Copy artifacts from /usr/local/ in the container"\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>a});var i=t(7294);const s={},c=i.createContext(s);function a(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);