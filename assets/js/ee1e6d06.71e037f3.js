"use strict";(self.webpackChunksite_v_3=self.webpackChunksite_v_3||[]).push([[6364],{4156:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>t});var s=i(5893),d=i(1151);const o={id:"multiple-sandboxes",title:"Multiple Project Sandboxes"},r=void 0,l={id:"multiple-sandboxes",title:"Multiple Project Sandboxes",description:"Sometimes it is useful to configure multiple sandboxes per project:",source:"@site/../docs/multiple-sandboxes.md",sourceDirName:".",slug:"/multiple-sandboxes",permalink:"/docs/multiple-sandboxes",draft:!1,unlisted:!1,editUrl:"https://github.com/esy/esy/tree/master/docs/../docs/multiple-sandboxes.md",tags:[],version:"current",lastUpdatedBy:"prometheansacrifice",lastUpdatedAt:1705048086,formattedLastUpdatedAt:"Jan 12, 2024",frontMatter:{id:"multiple-sandboxes",title:"Multiple Project Sandboxes"},sidebar:"docs",previous:{title:"Community",permalink:"/docs/community"},next:{title:"Building npm Releases",permalink:"/docs/npm-release"}},c={},t=[{value:"Configure multiple sandboxes",id:"configure-multiple-sandboxes",level:2},{value:"Sandbox configuration overrides",id:"sandbox-configuration-overrides",level:2},{value:"<code>build</code>",id:"build",level:3},{value:"<code>install</code>",id:"install",level:3},{value:"<code>exportedEnv</code>",id:"exportedenv",level:3},{value:"<code>exportedEnvOverride</code>",id:"exportedenvoverride",level:3},{value:"<code>buildEnv</code>",id:"buildenv",level:3},{value:"<code>buildEnvOverride</code>",id:"buildenvoverride",level:3},{value:"<code>dependencies</code>",id:"dependencies",level:3},{value:"<code>devDependencies</code>",id:"devdependencies",level:3},{value:"<code>resolutions</code>",id:"resolutions",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Sometimes it is useful to configure multiple sandboxes per project:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"to build a project with a different compiler version"}),"\n",(0,s.jsx)(n.li,{children:"to try a project with a different set of dependencies installed"}),"\n",(0,s.jsx)(n.li,{children:"to build a project using differeng settings configured via environment\nvariables"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["It is inconvenient to modify ",(0,s.jsx)(n.code,{children:"package.json"})," and reinstall dependencies each time\nyou want to work in a different sandbox configuration."]}),"\n",(0,s.jsx)(n.p,{children:"To streamline this esy provides an ability to have multiple sandbox\nconfigurations per project."}),"\n",(0,s.jsx)(n.h2,{id:"configure-multiple-sandboxes",children:"Configure multiple sandboxes"}),"\n",(0,s.jsxs)(n.p,{children:["Put ",(0,s.jsx)(n.code,{children:"ocaml-4.6.json"})," file into the project directory."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ocaml-4.6"})," can be any other name you like for your sandbox config:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"with-ocaml-4.6.json"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"debug-build.json"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ocaml-4.6.json"})," file should have the same format as ",(0,s.jsx)(n.code,{children:"package.json"})," but can have\ndifferent configuration for ",(0,s.jsx)(n.code,{children:"dependencies"}),", ",(0,s.jsx)(n.code,{children:"devDependencies"}),", ",(0,s.jsx)(n.code,{children:"esy.build"})," or\nother fields described in ",(0,s.jsx)(n.a,{href:"/docs/configuration",children:"Project Configuration"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"For example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  ...\n  "devDependencies": {\n    "ocaml": "~4.6.0"\n  }\n  ...\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["To instruct esy to work with ",(0,s.jsx)(n.code,{children:"ocaml-4.6.json"})," sandbox configuration (instead of\ndefault ",(0,s.jsx)(n.code,{children:"package.json"}),") you can use ",(0,s.jsx)(n.code,{children:"@ocaml-4.6"})," sandbox selector:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install the dependencies of the ",(0,s.jsx)(n.code,{children:"ocaml-4.6"})," sandbox:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"esy @ocaml-4.6 install\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Build the ",(0,s.jsx)(n.code,{children:"ocaml-4.6"})," sandbox:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"esy @ocaml-4.6 build\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run a command with the ",(0,s.jsx)(n.code,{children:"ocaml-4.6"})," sandbox environment:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"esy @ocaml-4.6 which ocaml\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Note that sandbox selector ",(0,s.jsx)(n.code,{children:"@<sandbox-name>"})," should be the first argument to\n",(0,s.jsx)(n.code,{children:"esy"})," command, otherwise it is treated as an option to a subcommand and won't\nhave the desired effect."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sandbox-configuration-overrides",children:"Sandbox configuration overrides"}),"\n",(0,s.jsxs)(n.p,{children:["When sandbox configurations differ just by few configuration parameters it is\ntoo much boilerplate to copy over all ",(0,s.jsx)(n.code,{children:"package.json"})," fields to a new sandbox\nconfiguration."]}),"\n",(0,s.jsx)(n.p,{children:"It is possible to use sandbox configuration overrides to aleviate the need in\nsuch boilerplate."}),"\n",(0,s.jsx)(n.p,{children:"Overrides have the following format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "source": "./package.json",\n  "override": {\n    <override-fields>\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Where ",(0,s.jsx)(n.code,{children:"source"})," key defines the origin configuration which is being overriden\nwith the fields from ",(0,s.jsx)(n.code,{children:"override"})," key."]}),"\n",(0,s.jsxs)(n.p,{children:["Not everything can be overriden and ",(0,s.jsx)(n.code,{children:"<override-fields>"})," can contain one or more\nof the following keys."]}),"\n",(0,s.jsx)(n.h3,{id:"build",children:(0,s.jsx)(n.code,{children:"build"})}),"\n",(0,s.jsxs)(n.p,{children:["This replaces ",(0,s.jsx)(n.a,{href:"/docs/configuration#esybuild",children:"esy.build"})," commands of the origin\nsandbox configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"override": {\n  "build": "dune build"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"install",children:(0,s.jsx)(n.code,{children:"install"})}),"\n",(0,s.jsxs)(n.p,{children:["This replaces ",(0,s.jsx)(n.a,{href:"/docs/configuration#esyinstall",children:"esy.install"})," commands of the origin\nconfiguration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"override": {\n  "install": "esy-installer project.install"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"exportedenv",children:(0,s.jsx)(n.code,{children:"exportedEnv"})}),"\n",(0,s.jsxs)(n.p,{children:["This replaces ",(0,s.jsx)(n.a,{href:"/docs/configuration#esyexportedenv",children:"esy.exportedEnv"})," set of exported\nenvironment variables of the origin configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"exportedEnv": {\n  "NAME": {"val": "VALUE", "scope": "global"}\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If you need to add to a set of exported environment variables rather than\nreplace the whole set use ",(0,s.jsx)(n.code,{children:"exportedEnvOverride"})," key instead."]}),"\n",(0,s.jsx)(n.h3,{id:"exportedenvoverride",children:(0,s.jsx)(n.code,{children:"exportedEnvOverride"})}),"\n",(0,s.jsxs)(n.p,{children:["This overrides ",(0,s.jsx)(n.a,{href:"/docs/configuration#esyexportedenv",children:"esy.exportedEnv"})," set of exported\nenvironment variables of the origin configuration."]}),"\n",(0,s.jsxs)(n.p,{children:["Environment variables specified using this key are being added instead of\nreplacing the entire set. If a declaration for an environment variable is set to\n",(0,s.jsx)(n.code,{children:"null"})," then the variable is removed from the set."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"exportedEnvOverride": {\n  "VAR_TO_ADD": {"val": "VALUE", "scope": "global"},\n  "VAR_TO_REMOVE": null\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"buildenv",children:(0,s.jsx)(n.code,{children:"buildEnv"})}),"\n",(0,s.jsxs)(n.p,{children:["This replaces ",(0,s.jsx)(n.a,{href:"/docs/configuration#esybuildenv",children:"esy.buildEnv"})," set of build\nenvironment variables of the origin configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"buildEnv": {\n  "NAME": "VALUE"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If you need to add to a set of build environment variables rather than\nreplace the whole set use ",(0,s.jsx)(n.code,{children:"buildEnvOverride"})," key instead."]}),"\n",(0,s.jsx)(n.h3,{id:"buildenvoverride",children:(0,s.jsx)(n.code,{children:"buildEnvOverride"})}),"\n",(0,s.jsxs)(n.p,{children:["This overrides ",(0,s.jsx)(n.a,{href:"/docs/configuration#esybuildenv",children:"esy.buildEnv"})," set of build\nenvironment variables of the origin configuration."]}),"\n",(0,s.jsxs)(n.p,{children:["Environment variables specified using this key are being added instead of\nreplacing the entire set. If a declaration for an environment variable is set to\n",(0,s.jsx)(n.code,{children:"null"})," then the variable is removed from the set."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"buildEnvOverride": {\n  "VAR_TO_ADD": "VALUE",\n  "VAR_TO_REMOVE": null\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"dependencies",children:(0,s.jsx)(n.code,{children:"dependencies"})}),"\n",(0,s.jsxs)(n.p,{children:["This overrides ",(0,s.jsx)(n.a,{href:"/docs/configuration#dependencies",children:"dependencies"})," set of dependency\ndeclaraations of the origin configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"dependencies": {\n  "dependency-to-add": "^1.0.0",\n  "dependency-to-remove": null\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"devdependencies",children:(0,s.jsx)(n.code,{children:"devDependencies"})}),"\n",(0,s.jsxs)(n.p,{children:["This overrides ",(0,s.jsx)(n.a,{href:"/docs/configuration#devDependencies",children:"devDependencies"})," set of dev\ndependencies of the origin configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"devDependencies": {\n  "dependency-to-add": "^1.0.0",\n  "dependency-to-remove": null\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"resolutions",children:(0,s.jsx)(n.code,{children:"resolutions"})}),"\n",(0,s.jsxs)(n.p,{children:["This replaces ",(0,s.jsx)(n.a,{href:"/docs/configuration#resolutions",children:"resolutions"})," set of dependency\nresolutions."]})]})}function h(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var s=i(7294);const d={},o=s.createContext(d);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);