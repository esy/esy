"use strict";(self.webpackChunksite_v_3=self.webpackChunksite_v_3||[]).push([[3908],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>u});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},m=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=s(t),c=i,u=d["".concat(p,".").concat(c)]||d[c]||k[c]||r;return t?a.createElement(u,l(l({ref:n},m),{},{components:t})):a.createElement(u,l({ref:n},m))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,l=new Array(r);l[0]=c;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[d]="string"==typeof e?e:i,l[1]=o;for(var s=2;s<r;s++)l[s]=t[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},4108:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var a=t(7462),i=(t(7294),t(3905));const r={id:"environment",title:"Environment"},l=void 0,o={unversionedId:"environment",id:"environment",title:"Environment",description:"For each project esy manages:",source:"@site/../docs/environment.md",sourceDirName:".",slug:"/environment",permalink:"/docs/environment",draft:!1,editUrl:"https://github.com/esy/esy/tree/master/docs/../docs/environment.md",tags:[],version:"current",lastUpdatedBy:"Manas Jayanth",lastUpdatedAt:1701663447,formattedLastUpdatedAt:"Dec 4, 2023",frontMatter:{id:"environment",title:"Environment"},sidebar:"docs",previous:{title:"Project Configuration",permalink:"/docs/configuration"},next:{title:"Commands",permalink:"/docs/commands"}},p={},s=[{value:"Build Environment",id:"build-environment",level:2},{value:"Command Environment",id:"command-environment",level:2},{value:"Test Environment (exported environment)",id:"test-environment-exported-environment",level:2},{value:"Variable substitution syntax",id:"variable-substitution-syntax",level:2}],m={toc:s},d="wrapper";function k(e){let{components:n,...t}=e;return(0,i.kt)(d,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"<AUTOGENERATED_TABLE_OF_CONTENTS>"),(0,i.kt)("p",null,"For each project esy manages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"build environment")," \u2014 an environment which is used to build the project")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"command environment")," \u2014 an environment which is used running text editors/IDE\nand for general testing of the built artfiacts")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"test environment")," \u2014 an environment which includes the current package's\ninstallation directories and its exported environment. This is useful if you need\nan environment in which the current application appears installed."))),(0,i.kt)("p",null,"Each environment consists of two parts:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Base environment provided by esy.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Environment exported from the sandbox dependencies. There are several types\nof dependencies esy can understand:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Regular dependencies")," are dependencies which are needed at runtime.\nThey are listed in ",(0,i.kt)("inlineCode",{parentName:"p"},'"dependencies"')," key of the ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Development time dependencies")," are dependencies which are needed only\nduring development. They are listed in ",(0,i.kt)("inlineCode",{parentName:"p"},'"devDependencies"')," key of the\n",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),". Examples: ",(0,i.kt)("inlineCode",{parentName:"p"},"@opam/merlin"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"@opam/ocamlformat")," and so on.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Build time dependencies")," (NOT IMPLEMENTED) are dependencies which are\nonly needed during the build of the project. Support for those is ",(0,i.kt)("strong",{parentName:"p"},"not\nimplemented")," currently. The workaround is to declare such dependencies as\nregular dependencies for the time being."))))),(0,i.kt)("h2",{id:"build-environment"},"Build Environment"),(0,i.kt)("p",null,"The following environment is provided by esy:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$SHELL")," is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"env -i /bin/bash --norc --noprofile")," so each build is\nexecuted in an environment clear from user customizations usually found in\n",(0,i.kt)("inlineCode",{parentName:"p"},".profile")," or other configuration files.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$PATH")," contains all regular dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/")," directories.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$MAN_PATH")," contains all regular dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"man/")," directories.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$OCAMLPATH")," contains all regular dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"lib/")," directories."))),(0,i.kt)("p",null,"Each regular dependency of the project can also contribute to the environment\nthrough ",(0,i.kt)("inlineCode",{parentName:"p"},'"esy.exportedEnv"')," key in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),". See ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration"},"Project\nConfiguration")," for details."),(0,i.kt)("h2",{id:"command-environment"},"Command Environment"),(0,i.kt)("p",null,"The following environment is provided by esy:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$PATH")," contains all regular ",(0,i.kt)("strong",{parentName:"p"},"and development")," time dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/"),"\ndirectories.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$MAN_PATH")," contains all regular ",(0,i.kt)("strong",{parentName:"p"},"and development")," dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"man/"),"\ndirectories.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$OCAMLPATH")," contains all regular ",(0,i.kt)("strong",{parentName:"p"},"and development")," dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"lib/"),"\ndirectories."))),(0,i.kt)("p",null,"Each regular ",(0,i.kt)("strong",{parentName:"p"},"and development")," dependency of the project can also contribute to the\nenvironment through ",(0,i.kt)("inlineCode",{parentName:"p"},'"esy.exportedEnv"')," key in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),". See ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration"},"Project\nConfiguration")," for details."),(0,i.kt)("h2",{id:"test-environment-exported-environment"},"Test Environment (exported environment)"),(0,i.kt)("p",null,"Some packages need to set environment variables in the environment of the package consuming them. Sometimes, a root package may need to set some variables in the sandbox if the binaries need them."),(0,i.kt)("p",null,"These environment variables are 'exported' using the ",(0,i.kt)("inlineCode",{parentName:"p"},"exportedEnv"),"."),(0,i.kt)("p",null,"By default, the following environment is provided by esy:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$PATH")," contains all regular time dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/"),"\ndirectories ",(0,i.kt)("strong",{parentName:"p"},"and project's own")," ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/")," directory.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$MAN_PATH")," contains all regular dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"man/"),"\ndirectories ",(0,i.kt)("strong",{parentName:"p"},"and project's own")," ",(0,i.kt)("inlineCode",{parentName:"p"},"man/")," directory.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$OCAMLPATH")," contains all regular dependencies' ",(0,i.kt)("inlineCode",{parentName:"p"},"lib/"),"\ndirectories  ",(0,i.kt)("strong",{parentName:"p"},"and project's own")," ",(0,i.kt)("inlineCode",{parentName:"p"},"lib/")," directory."))),(0,i.kt)("p",null,"Each regular dependency of the project ",(0,i.kt)("strong",{parentName:"p"},"and the project itself")," can also\ncontribute to the environment through ",(0,i.kt)("inlineCode",{parentName:"p"},'"esy.exportedEnv"')," key in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),".\nSee ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration"},"Project Configuration")," for details."),(0,i.kt)("h2",{id:"variable-substitution-syntax"},"Variable substitution syntax"),(0,i.kt)("p",null,"Your ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),"'s ",(0,i.kt)("inlineCode",{parentName:"p"},"esy"),' configuration can include "interpolation" regions\nwritten as ',(0,i.kt)("inlineCode",{parentName:"p"},"#{ }"),", where ",(0,i.kt)("inlineCode",{parentName:"p"},"esy"),' "variables" can be used which will automatically\nbe substituted with their corresponding values.'),(0,i.kt)("p",null,"For example, if you have a package named ",(0,i.kt)("inlineCode",{parentName:"p"},"@company/widget-factory")," at version\n",(0,i.kt)("inlineCode",{parentName:"p"},"1.2.0"),", then its ",(0,i.kt)("inlineCode",{parentName:"p"},"esy.build")," field in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," could be specified as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'   "build": "make #{@company/widget-factory.version}",\n')),(0,i.kt)("p",null,"and ",(0,i.kt)("inlineCode",{parentName:"p"},"esy")," will ensure that the build command is interpreted as ",(0,i.kt)("inlineCode",{parentName:"p"},'"make 1.2.0"'),".\nIn this example the interpolation region includes just one ",(0,i.kt)("inlineCode",{parentName:"p"},"esy")," variable\n",(0,i.kt)("inlineCode",{parentName:"p"},"@company/widget-factory.version")," - which is substituted with the version number\nfor the ",(0,i.kt)("inlineCode",{parentName:"p"},"@company/widget-factory")," package."),(0,i.kt)("p",null,"Package specific variables are prefixed with their package name, followed\nby an ",(0,i.kt)("inlineCode",{parentName:"p"},"esy"),' "property" of that package such as ',(0,i.kt)("inlineCode",{parentName:"p"},".version")," or ",(0,i.kt)("inlineCode",{parentName:"p"},".lib"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"esy")," also provides some other built in variables which help with path and environment\nmanipulation in a cross platform manner."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Supported Variable Substitutions:")),(0,i.kt)("p",null,"Those variables refer to the values defined for the current package:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.name")," represents the name of the package"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.version")," represents the version of the package (as defined in its\n",(0,i.kt)("inlineCode",{parentName:"li"},"package.json"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.root")," is the package source root"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.target_dir")," is the package build directory"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.jobs")," is the number of processors the build system can used parallely. The name ",(0,i.kt)("inlineCode",{parentName:"li"},"jobs")," is inspired by it counterpart in opam."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.install")," is the package installation directory, there are also\nvariables defined which refer to common subdirectories of ",(0,i.kt)("inlineCode",{parentName:"li"},"self.install"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.bin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.sbin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.lib")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.man")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.doc")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.stublibs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.toplevel")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.share")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"self.etc"))))),(0,i.kt)("p",null,"Note that for packages which have ",(0,i.kt)("inlineCode",{parentName:"p"},"buildsInSource: true")," esy copies sources into ",(0,i.kt)("inlineCode",{parentName:"p"},"self.target_dir")," and therefore values of ",(0,i.kt)("inlineCode",{parentName:"p"},"self.root")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"self.target_dir")," are the same."),(0,i.kt)("p",null,"You can refer to the values defined for other packages which are direct\ndependencies by using the respective ",(0,i.kt)("inlineCode",{parentName:"p"},"package-name.")," prefix. Available variables are the same:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.name")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.version")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.root")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.target_dir")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.install"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.bin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.sbin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.lib")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.man")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.doc")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.stublibs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.toplevel")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.share")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"package-name.etc"))))),(0,i.kt)("p",null,'The following constructs are also allowed inside "interpolation" regions:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$PATH"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"$cur__bin")," : environment variable references"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"'hello'"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"'lib'")," : string literals"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/")," : path separator (substituted with the platform's path separator)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},":")," : env var value separator (substituted with platform's env var separator ",(0,i.kt)("inlineCode",{parentName:"li"},":"),"/",(0,i.kt)("inlineCode",{parentName:"li"},";"),").")),(0,i.kt)("p",null,"You can join many of these ",(0,i.kt)("inlineCode",{parentName:"p"},"esy")," variables together inside of an interpolation region\nby separating the variables with spaces. The entire interpolation region will be substituted\nwith the concatenation of the space separated ",(0,i.kt)("inlineCode",{parentName:"p"},"esy")," variables."),(0,i.kt)("p",null,"White space separating the variables are not included in the concatenation, If\nyou need to insert a literal white space, use ",(0,i.kt)("inlineCode",{parentName:"p"},"' '")," string literal."),(0,i.kt)("p",null,"Examples:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},'"#{pkg.bin : $PATH}"'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"\"#{pkg.lib / 'stublibs' : $CAML_LD_LIBRARY_PATH}\"")))))}k.isMDXComponent=!0}}]);